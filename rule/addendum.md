---

# ICFP プログラミングコンテスト 2025

## 付録（ADDENDUM）

コンテスト開始から24時間経過した後、参加者は新たな複雑さに直面します。本タスク記述に加えられたこの「付録」によって、その複雑さが説明されています。

---

## 物語仕立ての導入

夜が深まり、修道院の廊（ラビリンス）に再び忍び込んだ William と Adso。彼らのランタンが揺れる光の中で、「以前とは異なるはずの部屋がまるで鏡に映したように現れ、さらに複製までされている」――そう気づきます。William は深刻な表情でこう言いました。

> 「この図書館は、たった一つの設計図ではなく、重なり合ったコピーの織りなすタペストリーのようだ。どれも見た目は同じに見える。」

Adso は足元さえも信じられなくなり、震えて言います。

> 「もしひとつの部屋さえも見分けがつかないのなら、正確な地図を描くことなんてできるのでしょうか？」

すると William は微笑み、「心配はいらない。各部屋に、それぞれの“特徴”を与えてやろう」と言いました。

---

## チャコールマークによる識別

William は Adso にチャコール（木炭）を持たせました。それを使って、各部屋の上にあるラベルを変更できるようにしたのです。これにより、同じように見える別の部屋と区別がつくようになります。ルートプランの中では、四角括弧 `[ ]` を使ってその“いたずら”（グラフィティ）を表現します。

例として以下のプランを考えてみてください：

```
2[3]12[0]
```

この意味は以下のとおりです：

1. ドア `2` を通る
2. 現在の部屋のラベルを `3` に書き換える
3. ドア `1` を通る
4. ドア `2` を通る
5. 現在の部屋のラベルを `0` に書き換える

ラベルの値は「修道院の暗号」に従い、2 ビット（`0`〜`3`）で表現される必要があります。再び同じ部屋を訪れると、そこには自分が書き込んだラベルが残っています。しかし、ルートプランが終了すると、司書の Alonzo がすべての標識を元に戻してしまうため、チャコールの痕跡は消えてしまいます。

---

## ステップ数の制限

ただし、Alonzo の目は鋭くなっています。彼の疑いを避けるため、William と Adso はルートプランに含めるドア通過の「ステップ数」を制限しなければなりません。具体的には、「ステップ数 ≤ 6n」（n は部屋の数）でなければなりません。これを超える長さの探索は、司書の注意を引きかねません。

---

## ライティングラウンド問題との違い

問題には “aleph”（ℵ）や “beth”（ℶ） といった記号が付いたものがあります。こうした問題では、2〜3 重に複製された部屋の区別が必要であり、チャコールによるマーキングなしには正しくマッピングすることができません。一方、オリジナルのライトニングラウンド問題（“primus” や “secundus”）では、すべての部屋が見た目で識別可能だったため、チャコールによるマーキングは不要でした。

---

## 正しさの定義（修正版）

これまでと同様に、ソリューションが「正しい」と評価されるのは、実際の図書館のレイアウトと「ルートプランに対して区別できない」ことです。ただし、今回からはそのルートプランにチャコールのマークが含まれていても構いません。

---

### 要点まとめ

* コンテスト開始から24時間後に仕様が追加されるアドデンダム。
* William と Adso はチャコールで部屋のラベルを書き換えることができる。
* 書き換えたラベルは再訪時に保持されるが、ルート終了後は元に戻る。
* ルートは「6n を超えるドア通過」は許されない。（n：部屋数）
* 複製された部屋を正しく識別するため、チャコールは必要な場合がある。
* 正しさは、元のルール通り「ルートプランに基づく不可視性」を満たすこと。ただし、チャコールを使った場合にも。

---

