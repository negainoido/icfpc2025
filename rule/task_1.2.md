## タスク概要

参加者は、迷宮のような図書館の地図を、繰り返しの探検遠征で情報を収集して構築するタスクを与えられます。これはバージョン **1.2** です — タスクページの変更履歴を参照してください。

## 背景

*我らが主人公アドソとウィリアムが、エディフィキウムの図書館に遭遇し、その中に隠された秘密を明らかにしようとする話。*

ミルナーのアドソとその師であるバッカスのウィリアムは、ついに聖クリーネ修道院に到着した。この修道院は評価の聖なる教団の修道士たちによって管理され、世界中のすべての関数が見つかると言われる世界的に有名なラムダの図書館の本拠地である。

図書館はエディフィキウムの大部分を占めている：夕日の中で回廊の上に長い影を落とす、大きく威圧的な要塞のような建物である。修道院長とその司書であるカリーのアロンゾによって厳重に警備されているため、ウィリアムとアドソは、修道士や修道女が国際関数型プログラミング会議で忙しい時にエディフィキウムに忍び込むという策略によってのみ図書館にアクセスできる。

エディフィキウムは巨大で、アロンゾと修道院長だけがそのすべての部屋と通路を知っている。図書館には呪いがかかっていて、招かれずに入った者は二度と出られなくなると言う者もいる。偉大な直感と論理の学者であるウィリアムは、そのような迷信を一蹴し、図書館の秘密を明らかにするという決意を固くしている。彼は師匠のヒルベルトの流儀で叫ぶ：「*Wir müssen wissen, wir werden wissen!*（我々は知らねばならない、我々は知るであろう！）」

常に疑い深く確信の持てないアドソは師匠に尋ねる：「司書の案内なしにどこへ行けばよいのでしょうか？地図すらありません！」

ウィリアムは目の奥に悪戯っぽい輝きを浮かべて答える：「そうだね、親愛なるアドソよ、我々は地図を作らねばならないのだ。」

## エディフィキウム

*図書館の構造と、ウィリアムとアドソの前にある課題の性質について説明する章。*

エディフィキウムは多数の六角形の部屋から構成されており、各辺にはドアがあり、0-5の番号がついている。各ドアを通って他の部屋への通路がある。部屋自体にもラベルが付いているが、そのラベルはアドソには読めない言語である。ウィリアムはその言語を理解しているが、衰えた視力のため、ラベルの最初の2ビットしか識別できない。複数の部屋が同じラベルを持つ場合もある。通路は開始した部屋と同じ部屋に戻る場合もあり、同じドアに戻る場合さえある。

![image](https://hackmd.io/_uploads/ByuoXLdclx.png)


道に迷わないよう、アドソとウィリアムは図書館に入る前に**ルートプラン**を考案しなければならない。ルートプランは0-5の一連の数字で構成され、初期の部屋から開始して、通る予定のドアの順序を示す。ルートプランは常に同じ部屋から開始する。

彼らがルートプランに従って図書館を移動すると、アドソはウィリアムが各部屋のラベルから読み取る2ビット整数を記録する。したがって、長さ $x$ のルートプランを実行した後、アドソは $x+1$ 個の2ビット整数からなる記録を持つことになる。

アドソとウィリアムの前にある課題は、無向グラフの形で正確な図書館の地図を構築するのに必要な情報を得るために、可能な限り少ない回数の図書館への遠征で一連のルートプランを構築することである。

## プロトコル

*ルートプランとアドソの記録の形式、および地図の表現について説明する章。*

エディフィキウムへのクエリは、次のURLのサーバーにHTTPリクエストを行うことで実行される：

`https://31pwr5t6ij.execute-api.eu-west-2.amazonaws.com/`

### **POST `/register`** - *新しいチームを登録する*

**リクエストボディ：**
```typescript
{
  "name": string,
  "pl": string,
  "email": string
}
```

**レスポンスボディ：**
```typescript
{
  "id": string
}
```

レスポンスで提供される`id`は**秘密**であり、今後のリクエストでチームを識別するために使用される。覚えておいて、公開しないこと！

### **POST `/select`** - *解決する問題を選択する*

**リクエストボディ：**
```typescript
{
  "id": string,
  "problemName": string,
}
```

**レスポンスボディ：**
```typescript
{
  "problemName": string
}
```

`id`は`/register`で生成された文字列と正確に同じものでなければならない。`problemName`は利用可能な問題のいずれかで、完全なリストは[リーダーボードページ](https://icfpcontest2025.github.io/aedificium.html)で確認できる。各問題には指定された部屋数があるが、地図の正確なレイアウトは問題が選択されるたびにランダムに生成される。

テスト目的のため、手動で解決できるほど小さな3部屋の迷宮は、問題名 `"probatio"` を使用して選択することもできる。

問題が既に選択されている場合、`/select` にPOSTすると古い問題が破棄され、解決する新しい問題が生成される。

### **POST `/explore`** - *エディフィキウムを探検する*

**リクエストボディ：**
```typescript
{
  "id": string,
  "plans": [string],
}
```

**レスポンスボディ：**
```typescript
{
  "results": [[int]],
  "queryCount": int
}
```

`/select`で問題を選択した後にのみ`/explore`にPOSTする。

`id`は`/register`で生成された文字列と正確に同じものでなければならない。`plans`フィールドはルートプランのリストで構成され、各ルートプランは`0`-`5`の数字の文字列として表現され、入るべき各ドアの番号を指定する。例えば、文字列`"0325"`はまずドア`0`に入り、次に`3`、次に`2`、次に`5`に入るルートプランである。

ルートプランは長さに制限がある — アドソは日の出までに図書館から出なければならない。彼らは1夜につき最大で*18n*個のドアを通ることができ、ここで*n*は図書館の部屋数である。

`results`フィールドは、提出された各ルートプランに対するアドソの記録のリストで構成される。各記録は整数値のリスト — 各部屋に入るときにウィリアムが観察した2ビット整数値である。`queryCount`フィールドには、これまでにエディフィキウムに行った遠征の総数が含まれる。アドソとウィリアムは可能な限り少ない図書館への遠征を行いたいので、低い`queryCount`で行われた推測はリーダーボードでより高くランクされる。

**注記**：単一のHTTPリクエストで複数のルートプランを提出することを許可している。これによりサーバーコストが削減されるため、参加者にルートプランをバッチ処理することを奨励するために、`/explore`リクエストごとに追加の1ポイントの`queryCount`ペナルティが適用される。

### **POST `/guess`** - *候補地図を提出する*

**リクエストボディ：**
```typescript
{
  "id": string,
  "map": {
    "rooms": [int],
    "startingRoom": int,
    "connections": [
      {
        "from": { 
          "room": int, 
          "door": int 
        },
        "to": { 
          "room": int, 
          "door": int 
        }
      }
    ]
  }
}
```

**レスポンスボディ：**
```typescript
{
  "correct": boolean
}
```

`/select`で問題を選択した後にのみ`/guess`にPOSTする。

`id`は`/register`で生成された文字列と正確に同じものでなければならない。`map`フィールドには図書館のレイアウトの説明が含まれる。この説明の`rooms`フィールドは、ウィリアムが読み取った2ビット整数ラベルのリストで、部屋ごとに1つずつある。部屋はこのリストへのインデックスによって識別される。`startingRoom`フィールドは初期部屋のインデックスを指定する。`connections`フィールドには各部屋がどのように接続されているかを指定するオブジェクトのリストが含まれ、`room`フィールドは部屋のインデックスを指定し、`door`フィールドはドア番号`0`-`5`を指定する。構築されるグラフは無向であることに注意。例えば、部屋5のドア3から部屋2のドア0への接続が既にある場合、部屋2のドア0から部屋5のドア3への接続は不要である — この接続は既に存在する。

`correct`フィールドは、提出された地図が`/select`が呼び出されたときに生成された地図と**等価**である場合に`true`である。**等価**とは、同じ数の部屋を持ち、あらゆるルートプランによって区別できないことを意味する — 同じサイズの2つの地図の違いを示すルートプランがない場合、それらは等価と見なされる。

正しい地図が提出され、チームの`queryCount`が現在選択されている問題の以前のスコアを改善している場合、スコアが更新される。

提出された地図が正しいかどうかに関係なく、`/guess`が呼び出されると**問題は選択解除され**、図書館はクリアされる。これは、推測が間違っていた場合、`/select`で新しい地図で再開始しなければならないことを意味する。

## スコアリング

*エントリが評価される基準と、グローバルスコアボードへのポインタについて説明する章。*

![image](https://hackmd.io/_uploads/Sk41rIucel.png)

正しい地図の評価は、それらが生成された**効率性**に基づく：具体的には、グラフを生成するのに必要な遠征の回数である。

各チームは各問題のローカルリーダーボードでランク付けされ、地図を正しく生成するのに最も少ない遠征を要したチームが1位にランクされ、その問題にまだ正しい解答を提出していないすべてのチームが同じく最下位にランクされる。

[グローバルリーダーボード](https://icfpcontest2025.github.io/aedificium.html)は、昨年のコンテストと同様に、ボルダカウント法を使用して計算される。各問題について、各チームはランキングで明確に下位に位置する他のチームごとに1ポイントを与えられる。すべての問題で最も多くのポイントを持つチームがグローバルリーダーボードで1位にランクされる。このシステムの重要な特性は、問題の絶対スコアは関係なく、相対的な順序のみが重要であることである。

リーダーボードはコンテストの大部分を通じて数分ごとに更新されるが、ライトニングラウンドの終了2時間前とコンテストの最後の2時間では一時的に凍結され、サスペンスを高める。


## 提出

*参加方法とエントリ提出方法、およびそれが利用可能な日付について説明する章。*

賞品の対象となるためには、チームはコードを提出しなければならない。これは次のGoogleフォームを通じて行われる。`/register`からの`id`と、コードにアクセスできるURL（例：Gitリポジトリ）を含める。コンテスト終了まではコードを公開しないこと。

`https://forms.gle/M5SNTamHvoc6zWHq7`

このフォームはコンテスト終了3時間後に閉じられる。ライトニングラウンドのための別の提出は必要ないが、最初の24時間からの部分を示すREADMEファイルを含めること。

我々は「審査員賞」も授与するため、スコアボードのトップに立つことは勝利に必須ではない（しかし勝利の推奨方法である）。
